<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VOTE | Miss Pageant 2026</title>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;600&display=swap" rel="stylesheet">
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        /* CSS ‡∏ä‡∏∏‡∏î‡πÄ‡∏î‡∏¥‡∏° Luxury Black & Gold */
        :root { --gold: #d4af37; --bg: #121212; --card: #1e1e1e; }
        body { font-family: 'Prompt', sans-serif; background: var(--bg); color: #fff; margin: 0; padding: 20px; text-align: center; }
        .container { max-width: 400px; margin: 0 auto; background: var(--card); padding: 30px; border-radius: 20px; border: 1px solid #333; }
        h2 { color: var(--gold); margin-bottom: 5px; text-transform: uppercase; }
        select, input { width: 100%; padding: 12px; margin-bottom: 15px; background: #2a2a2a; border: 1px solid #444; color: #fff; border-radius: 10px; box-sizing: border-box; }
        .btn-vote { width: 100%; padding: 15px; background: linear-gradient(135deg, #d4af37, #f9e29c); border: none; border-radius: 30px; font-weight: bold; cursor: pointer; color: #000; font-size: 18px; }
        .btn-vote:disabled { opacity: 0.5; }
        .highlight { color: var(--gold); font-weight: bold; }
        #status { margin-top: 15px; font-size: 14px; }
    </style>
</head>
<body>

<div class="container">
    <h2>OFFICIAL VOTE</h2>
    <p style="color:#888; font-size:12px;">‡πÇ‡∏´‡∏ß‡∏ï‡πÉ‡∏´‡πâ‡∏ú‡∏π‡πâ‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏Å‡∏ß‡∏î‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô<br>‡∏£‡∏∞‡∏ö‡∏ö‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥ 24 ‡∏ä‡∏°.</p>
    
    <label style="display:block; text-align:left; color:var(--gold); margin-bottom:5px;">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏≤‡∏á‡∏á‡∏≤‡∏°:</label>
    <select id="contestantNo">
        <option value="">-- ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å --</option>
        <option value="01">No.01 - ‡∏ô‡πâ‡∏≠‡∏á‡πÄ‡∏≠</option>
        <option value="02">No.02 - ‡∏ô‡πâ‡∏≠‡∏á‡∏ö‡∏µ</option>
        <option value="15">No.15 - ‡∏ô‡πâ‡∏≠‡∏á‡∏ã‡∏µ</option>
    </select>

    <div style="background:#333; padding:10px; border-radius:10px; margin-bottom:20px; font-size:12px;">
        üî• <b>‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡πÅ‡∏£‡∏á!</b><br>
        1,000 ‡∏ö‡∏≤‡∏ó = <span class="highlight">1,150 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô</span><br>
        10,000 ‡∏ö‡∏≤‡∏ó = <span class="highlight">13,000 ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô (VVIP)</span>
    </div>

    <label style="display:block; text-align:left; color:var(--gold); margin-bottom:5px;">‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô:</label>
    <input type="file" id="slipFile" accept="image/*">

    <button onclick="submitVote()" id="btnVote" class="btn-vote">‡∏™‡πà‡∏á‡∏ú‡∏•‡πÇ‡∏´‡∏ß‡∏ï</button>
    <div id="status"></div>
</div>

<script>
    // ‚ö†Ô∏è ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç URL BACKEND ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ó‡∏≠‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà (‡∏≠‡∏¢‡πà‡∏≤‡∏•‡∏∑‡∏° /verify-vote)
    const BACKEND_URL = "https://miss-seven-queen-api.vercel.app/";
    
    // ‚ö†Ô∏è ‡πÉ‡∏™‡πà LIFF ID ‡∏Ç‡∏≠‡∏á‡πÄ‡∏ó‡∏≠‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà
    const LIFF_ID = "1660826063-Cy2t8mh6";

    async function main() {
        await liff.init({ liffId: LIFF_ID });
        if (!liff.isLoggedIn()) liff.login();
    }
    main();

    async function submitVote() {
        const fileInput = document.getElementById('slipFile');
        const contestantNo = document.getElementById('contestantNo').value;
        const status = document.getElementById('status');
        const btn = document.getElementById('btnVote');

        if (contestantNo === "") return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ô‡∏≤‡∏á‡∏á‡∏≤‡∏°‡∏Å‡πà‡∏≠‡∏ô‡∏Ñ‡πà‡∏∞");
        if (!fileInput.files[0]) return alert("‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÅ‡∏ô‡∏ö‡∏™‡∏•‡∏¥‡∏õ‡∏Ñ‡πà‡∏∞");

        btn.disabled = true;
        btn.innerText = "‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö...";
        status.innerText = "";

        const reader = new FileReader();
        reader.readAsDataURL(fileInput.files[0]);
        reader.onload = async () => {
            const base64Image = reader.result.split(',')[1]; // ‡∏ï‡∏±‡∏î header‡∏ó‡∏¥‡πâ‡∏á

            try {
                const response = await fetch(BACKEND_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ image: base64Image, contestantNo })
                });

                const result = await response.json();

                if (result.success) {
                    status.innerHTML = `<span style="color:#d4af37">‚úÖ ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢! ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô ${result.points} ‡∏ñ‡∏π‡∏Å‡∏™‡πà‡∏á‡πÉ‡∏´‡πâ No.${result.contestantNo} ‡πÅ‡∏•‡πâ‡∏ß</span>`;
                    alert(`‡∏Ç‡∏≠‡∏ö‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡πà‡∏∞! ‡πÇ‡∏´‡∏ß‡∏ï‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à ${result.points} ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô`);
                    // ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ü‡∏≠‡∏£‡πå‡∏°
                    document.getElementById('slipFile').value = ""; 
                } else {
                    status.innerHTML = `<span style="color:red">‚ùå ${result.message}</span>`;
                    alert(result.message);
                }
            } catch (err) {
                console.error(err);
                status.innerText = "‚ùå ‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠";
            } finally {
                btn.disabled = false;
                btn.innerText = "‡∏™‡πà‡∏á‡∏ú‡∏•‡πÇ‡∏´‡∏ß‡∏ï";
            }
        };
    }
</script>
</body>
</html>